#!/bin/bash 

# uninstall old instances to ensure all data is removed
rm -rf ~/tools/BloodHound
sudo systemctl stop neo4j
sudo systemctl disable neo4j
sudo apt remove --purge -y neo4j
sudo rm -rf /var/lib/neo4j
sudo rm -rf /etc/neo4j
sudo rm -rf /var/log/neo4j
sudo rm /etc/apt/sources.list.d/neo4j.list

# install new instances
sudo apt update && sudo apt upgrade 
sudo apt install -y wget apt-transport-https
wget -O - https://debian.neo4j.com/neotechnology.gpg.key | sudo apt-key add -
echo 'deb https://debian.neo4j.com stable 4.3' | sudo tee /etc/apt/sources.list.d/neo4j.list
sudo apt update
sudo apt install -y neo4j
wget https://github.com/BloodHoundAD/BloodHound/releases/download/4.1.0/BloodHound-linux-x64.zip
unzip BloodHound-linux-x64.zip
cd BloodHound-linux-x64
sudo apt install npm
sudo npm install -g electron
npm install
npm run linuxbuild

# run instances
chmod +x BloodHound
./BloodHound &
sudo neo4j console &
